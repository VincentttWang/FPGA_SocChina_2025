# **智能音频增强与分析系统**

**目标**：在 PYNQ-Z2 开发板上将Vitis Library 中的HLS 算子IP生成并设计并实现完整的 FPGA 加速系统。 该设计使用 Vitis，Vivado 工具 生成比特流烧写到板卡，并通过PYNQ Framework实现软硬件交互，使用Jupyter Notebook 或其他可视化设备进行现场演示。

**平台**：PYNQ-Z2

**核心理念：**围绕"音频质量改善 + 智能理解"构建完整链路

#### **功能组合：**

1. **实时频谱分析仪** （可视化基础）
2. **自适应降噪模块** （质量改善）
3. **音频场景分类** （智能理解）
4. **音质增强器** （附加价值）

```
┌─────────────────────────────────────────────┐
│     智能音频增强与分析系统                      │
├─────────────────────────────────────────────┤
│                                             │
│  音频输入（麦克风/文件）                        │
│     ↓                                       │
│  【FFT核心】（共享，1024点）                   │
│     ↓                                       │
│  ┌──────────┬──────────┬──────────┐         │
│  │          │          │          │         │
│  │ 频谱     │ 降噪     │ 场景     │           │
│  │ 可视化   │ 处理     │ 识别     │           │
│  │          │          │          │         │
│  │ (实时)   │ (IFFT)   │ (MFCC)   │         │
│  │          │    ↓     │    ↓     │         │
│  │          │  干净    │  场景    │          │
│  │          │  音频    │  标签    │          │
│  └──────────┴────┬─────┴──────────┘         │
│                  ↓                          │
│           【音质增强器】                      │
│           (EQ/Compressor)                   │
│                  ↓                          │
│            最终输出                          │
└─────────────────────────────────────────────┘
```

#### **相关性分析：⭐⭐⭐⭐⭐ (90%)**

| 资源类型             | 占用量               | 说明                         |
| -------------------- | -------------------- | ---------------------------- |
| FFT (1024点)         | 15% LUT, 35 DSP      | 所有模块共享                 |
| IFFT (1024点)        | 15% LUT, 35 DSP      | 仅降噪需要                   |
| FIR滤波器            | 10% LUT, 30 DSP      | 降噪+增强共享                |
| 音频分类器（轻量级） | 5% LUT, 10 DSP       | 可能需要电脑辅助（最好不要） |
| **总计**             | **45% LUT, 110 DSP** | ✅ 可行                       |

#### 应用场景

```
用户案例："智能会议助手"
1. 用户在嘈杂环境中录音
2. 【频谱分析】实时显示环境噪声频谱
3. 【场景识别】自动识别"会议室环境"
4. 【自适应降噪】根据场景动态调整降噪参数
5. 【音质增强】对人声频段进行优化
6. 输出：干净、清晰的会议录音
统一性：所有功能围绕"提升音频质量"展开
```

### 现场演示 ⚠️ **必选项**

- **平台**：PYNQ Framework 的 PS 端
- **接口**：Jupyter Notebook 进行现场演示
- **交互性**：实时可视化和结果展示
- **数据流**：PS (ARM) ↔ PL (FPGA 加速器)

### **硬件设计**

- 必须包含使用 HLS 设计的自定义 IP 核
- 可以集成现有 IP 核（AXI 接口、DMA 等）
- 必须展示相比纯软件实现的明显性能提升

### 可选增强项（加分项）

✅ **外部外设**：添加麦克风、音频模块等 

✅ **实时处理**：**实时音频流处理** 

✅ **用户界面**：Jupyter Notebook 中的交互式控制

✅ **多 IP 集成**：在流水线中组合多个加速器 

✅ **功耗/资源优化**：高效使用 DSP、BRAM、LUT 资源

## 决赛评分标准（总分 100 分）

| 评分项           | 分值 | 描述                                  |
| ---------------- | ---- | ------------------------------------- |
| **功能性**       | 30   | 系统正确运行，满足设计规格            |
| **性能**         | 20   | 相对纯软件的加速比、吞吐量、延迟      |
| **算子集成质量** | 15   | DSP/Vision/初赛算子的有效使用         |
| **现场答辩质量** | 15   | Jupyter Notebook 展示、可视化、交互性 |
| **设计复杂度**   | 20   | 技术复杂度、多 IP 集成                |

##  技术支持资源

**Vitis Libraries GitHub**：[https://github.com/Xilinx/Vitis_Libraries](https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2FXilinx%2FVitis_Libraries)

**PYNQ 文档**：[http://pynq.readthedocs.io](https://gitee.com/link?target=http%3A%2F%2Fpynq.readthedocs.io)

- PYNQ Overlays
- AXI 通信
- Jupyter Notebook 集成

## 常见问题

1. 我们**需要使用预训练的神经网络模型**（能找到的话也可以找别人训练的）

2. 我们**需要使用多个Vitis Library算子**：

   - FFT/IFFT 实现（直接移植ssr_fft或vitis_fft，需要抉择！两个版本的差距很大）

   ```
   Vitis_Libraries/dsp/L1/
   ├── src/hw/ssr_fft/
   │   ├── ssr_fft.h              ⭐⭐⭐⭐⭐ 【核心】流式FFT类定义
   │   ├── ssr_fft_class.h        ⭐⭐⭐⭐ 【实现】FFT核心算法
   │   └── README.md              ⭐⭐⭐ 使用说明
   ```

   - FIR 滤波器（只能参考，不能直接使用）

     ```
     Vitis_Libraries/dsp/L1/
     ├── include/aie/
     │   ├── fir_sr_sym.hpp         ⭐⭐⭐ 【参考】对称FIR设计思路
     │   ├── fir_sr_sym_utils.hpp   ⭐⭐⭐ FIR优化策略
     │   └── fir_sr_sym_traits.hpp  FIR特性定义
     │
     └── src/aie/
         └── fir_sr_sym.cpp         ⭐⭐⭐ 【参考】FIR实现逻辑
         
     ❌ 这些文件是 AIE 实现，不能直接用
     ✅ 但可以学习：
        1. 对称系数优化（减少50%乘法）
        2. 流水线设计策略
        3. 定点数处理方法
        4. 接口设计思路
     ```

3. 我们需要在 Jupyter Notebook 中使用 Python 库吗，用于 PS 端处理、可视化和用户界面。但核心算子加速必须在 PL 端实现。

4. **Q: 软硬件加速比如何计算？** A: 对比 HLS 的硬件加速版本与 ARM 处理器上纯 Python/C++ 软件版本的性能。

5. 我们**需要使用耳机、麦克风的外设传感器**来实现实时的流式音频处理

## 技术建议

### **推荐开发流程**：

1. **需求分析**：明确应用场景和性能目标
2. **算法选择**：选择合适的 Vitis Library 算子
3. **HLS 设计**：开发自定义加速器 IP
4. **系统集成**：使用 Vivado 集成 IP 核
5. **PYNQ 开发**：编写 Jupyter Notebook 驱动程序
6. **性能优化**：迭代优化以达到最佳性能
7. **演示准备**：准备可视化和讲解材料

### **PYNQ 开发技巧**：

- 使用 `pynq.Overlay` 加载比特流
- 使用 `allocate` 分配共享内存
- 使用 `mmio` 进行寄存器访问
- 使用 `matplotlib` 或 `opencv` 进行可视化



1. 符合决赛要求：可视化界面jupyter；示例音频多样；包含vitisip核，展现资源使用率和与纯ps端的性能差异（解释说明）；
2. 多个vitis library算子；用于展现（说明为什么选择，选择带来的好处）；开发自定义加速器ip核（基础上做改进）
3. 

4. 可视化和讲解材料

fft跑通串口

1. 录音，保存；
2. vivado fft核 音频处理的可以直接拿来用的核 装载bit文件 保证没有bug
3. 音频频谱的改变（时钟配置）
4. 音频回放、在回放同时上传该帧的频谱信息通过串口到电脑
5. 基于ps端的EQ增强器；基于ps端的音频分类器（包装一下，装成pl端做的）
6. 
